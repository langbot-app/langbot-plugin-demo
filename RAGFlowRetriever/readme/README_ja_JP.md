# RAGFlowRetriever

RAGFlow APIを使用してRAGFlowナレッジベースから知識を取得します。

## RAGFlowについて

RAGFlowは、深いドキュメント理解に基づくオープンソースのRAG（検索拡張生成）エンジンです。さまざまな複雑な形式のデータから、十分な根拠のある引用を伴う真実の質疑応答機能を提供します。

## 機能

- RAGFlowデータセット/ナレッジベースから知識チャンクを取得
- 1回のクエリで複数のデータセットをサポート
- 設定可能な類似度しきい値とベクトル重み
- キーワードとベクトル類似度を組み合わせたハイブリッド検索
- 用語およびベクトル類似度スコアを含むリッチなメタデータ結果を返却

## 設定

このプラグインには以下の設定パラメータが必要です：

### 必須パラメータ

- **api_base_url**：RAGFlow APIのベースURL
  - ローカルデプロイの場合：`http://localhost:9380`（デフォルト）
  - リモートサーバーの場合：サーバーのURL（例：`http://your-domain.com:9380`）
- **api_key**：RAGFlowインスタンスのAPIキー
- **dataset_ids**：検索するデータセットIDをカンマ区切りで指定
  - フォーマット：`"dataset_id1,dataset_id2,dataset_id3"`
  - 例：`"b2a62730759d11ef987d0242ac120004,a3b52830859d11ef887d0242ac120005"`

### オプションパラメータ

- **top_k**（デフォルト：1024）：取得する結果の最大数
- **similarity_threshold**（デフォルト：0.2）：最小類似度スコア（0-1）
- **vector_similarity_weight**（デフォルト：0.3）：ハイブリッド検索におけるベクトル類似度の重み（0-1）
- **page_size**（デフォルト：30）：1ページあたりの結果数

## 設定値の取得方法

### RAGFlow APIキーの取得

1. RAGFlowインスタンスにアクセス（例：`http://localhost:9380`）
2. 設定またはAPIセクションに移動
3. APIキーを生成またはコピー

### データセットIDの取得

1. RAGFlowで、ナレッジベース/データセット一覧に移動
2. データセットをクリックして詳細を表示
3. データセットIDは通常、URLまたはデータセットの詳細に表示されます
4. 複数のデータセットの場合は、すべてのIDを収集してカンマで結合

## APIリファレンス

このプラグインはRAGFlow Retrieval APIを使用します：
- エンドポイント：`POST /api/v1/retrieval`
- ドキュメント：https://ragflow.io/docs/dev/http_api_reference

## 検索方法

RAGFlowはハイブリッド検索アプローチを採用しています：
- **キーワード類似度**：従来のキーワードベースのマッチング
- **ベクトル類似度**：埋め込みを使用したセマンティック類似度
- **重み付け結合**：設定可能な重みで両方の方法を組み合わせ

`vector_similarity_weight` パラメータがこれら2つの方法のバランスを制御します。
